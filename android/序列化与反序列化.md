# 序列化与反序列化



### 1. 定义

互联网的产生带来了机器间通讯的需求，而互联通讯的双方需要采用约定的协议，序列化和反序列化属于通讯协议的一部分。通讯协议往往采用分层模型，不同模型每层的功能定义以及颗粒度不同，例如：TCP/IP协议是一个四层协议，而OSI模型却是七层协议模型。在OSI七层协议模型中展现层（Presentation Layer）的主要功能是把应用层的对象转换成一段连续的二进制串，或者反过来，把二进制串转换成应用层的对象–这两个功能就是序列化和反序列化。一般而言，TCP/IP协议的应用层对应与OSI七层协议模型的应用层，展示层和会话层，所以序列化协议属于TCP/IP协议应用层的一部分。本文对序列化协议的讲解主要基于OSI七层协议模型。

- 序列化： 将数据结构或对象转换成二进制串的过程
- 反序列化：将在序列化过程中所生成的二进制串转换成数据结构或者对象的过程



### 2.协议

#### 1. ProtoBuf

Protocol Buffer主要的优势在于三点：

（1）体积小速度快。像XML这种报文是基于文本格式的，存在大量的描述信息，虽然对于人来说可读性更好，但增加了序列化时间、网络传输时间等。导致系统的整体性能下降。而PB则将信息序列化为二进制的格式，安全性提高的同时，序列化后的数据大小缩小了3倍，序列化速度比Json快了20-100倍，也必然会减小网络传输时间。

（2）跨平台跨语言。接收端和发送端只需要维护同一份proto文件即可。proto编译器会根据不同的语言，生成对应的代码文件。

（3）向后兼容性。还有一个非常重要的优点就是可以不必破坏旧的数据格式，就可以直接对数据结构进行更新。

Protobuf 缺点

通用性较差 : 目前 XML / JSON 广泛使用 , 是行业标准的序列化 , 反序列化格式 ;

解释性差 : 序列化 , 反序列化 Protobuuf , 需要有 Protobuf 源文件才可以进行 ;

#### 2. Json

总的来说，采用JSON进行序列化的额外空间开销比较大，对于大数据量服务或持久化，这意味着巨大的内存和磁盘开销，这种场景不适合。没有统一可用的IDL降低了对参与方的约束，实际操作中往往只能采用文档方式来进行约定，这可能会给调试带来一些不便，延长开发周期。 由于JSON在一些语言中的序列化和反序列化需要采用反射机制，所以在性能要求为ms级别，不建议使用。

#### 3. Xml



### 3. 总结

Protocol Buffer 和 XML、JSON一样都是结构数据序列化的工具，用来实现数据的传递、转换等功能。

- Protocol Buffer序列化之后的结果是二进制流，和XML、JSON不同，不是可以直接理解的字符串内容；
- XML和JSON数据在序列化之后，不需要借助其他工具就可以还原，而Protocol Buffer需要先定义数据格式，即.proto协议；
- 性能方面，Protocol Buffer拥有更优的表现，Protocol Buffer比XML和JSON的体积更小（小3-10倍），序列化和反序列化更快（快20-100倍），使用也简单；





