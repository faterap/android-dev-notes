# FA卡片

## 1. 基本概念

- 卡片使用方

  显示卡片内容的宿主应用，控制卡片在宿主中展示的位置。

- 卡片管理服务

  用于管理系统中所添加卡片的常驻代理服务，包括卡片对象的管理与使用，以及卡片周期性刷新等。

- 卡片提供方

  提供卡片显示内容的HarmonyOS应用或原子化服务，控制卡片的显示内容、控件布局以及控件点击事件。

  > 卡片使用方和提供方不要求常驻运行，在需要添加/删除/请求更新卡片时，卡片管理服务会拉起卡片提供方获取卡片信息。

## 2. 服务卡片运作机制

![点击放大](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20210702111859.85076227145362969263053337109121:50520704022932:2800:CB9F3AEB0D938C6E50C1FCAF50E1ECE66A6B8AF7843C598B4D7F65F2C2CB127F.png?needInitFileName=true?needInitFileName=true)

- - **卡片管理服务包含以下模块：**

    - 周期性刷新：在卡片添加后，根据卡片的刷新策略启动定时任务周期性触发卡片的刷新。
    - 卡片缓存管理：在卡片添加到卡片管理服务后，对卡片的视图信息进行缓存，以便下次获取卡片时可以直接返回缓存数据，降低时延。
    - 卡片生命周期管理：对于卡片切换到后台或者被遮挡时，暂停卡片的刷新；以及卡片的升级/卸载场景下对卡片数据的更新和清理。
    - 卡片使用方对象管理：对卡片使用方的RPC对象进行管理，用于使用方请求进行校验以及对卡片更新后的回调处理。
    - 通信适配层：负责与卡片使用方和提供方进行RPC通信。

    **卡片提供方包含以下模块：**

    - 卡片服务：由卡片提供方开发者实现，开发者实现onCreateForm、onUpdateForm和onDeleteForm处理创建卡片、更新卡片以及删除卡片等请求，提供相应的卡片服务。
    - 卡片提供方实例管理模块：由卡片提供方开发者实现，负责对卡片管理服务分配的卡片实例进行持久化管理。
    - 通信适配层：由HarmonyOS SDK提供，负责与卡片管理服务通信，用于将卡片的更新数据主动推送到卡片管理服务。

## 3. 接口说明

![点击放大](https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20210702111859.92582264611953438954536903230711:50520704022932:2800:50753D57716EF9EA207328DFC2A555B426888E44696BB82812C927802114E23D.png?needInitFileName=true?needInitFileName=true)