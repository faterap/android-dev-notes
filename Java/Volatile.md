# Volatile 含义

### 1. Java内存模型

Java内存模型（Java Memory Model 简称 JMM），决定一个一个线程对共享变量的写入何时对其它线程可见。JMM定义了线程和主内存之间的抽象关系：

> 线程之间共享变量存储在主内存中，每个线程都有一个私有的本地内存，本地内存中存储了该线程共享变量的副本。本地内存是JMM的一个抽象概率，并不真实的存在。它涵盖了缓存，写缓存区，寄存器以及其他的硬件和编译优化。



![img](https://pic3.zhimg.com/80/v2-59f4771a048d2940191101faef940876_1440w.jpg)

### 2.  含义

Java 语言中的 volatile 变量可以被看作是一种 “程度较轻的 synchronized”；与 synchronized 块相比，volatile 变量所需的编码较少，并且运行时开销也较少，但是它所能实现的功能也仅是 synchronized 的一部分。

**volatile可以保证线程可见性且提供了一定的有序性，但是无法保证原子性**。

### 3. 作用

- 防止指令重排序
- 修饰变量的时候，所以线程都会直接读取该变量并且不缓存它。这就确保了线程读取到的变量是同内存中是一致的

Volatile变量修饰符如果使用恰当的话，它**比synchronized的使用和执行成本会更低，因为它不会引起线程上下文的切换和调度**。

### 4. 实现原理

java 编译器在生成指令序列的适当位置会插入内存屏障指令来禁止特定类 型的处理器重排序，从而让程序按我们预想的流程去执行。

1、保证特定操作的执行顺序。

2、影响某些数据(或则是某条指令的执行结果)的内存可见性。

java的内存屏障指令如下：

![天天在用volatile，你知道它的底层原理吗？](https://segmentfault.com/img/remote/1460000037486489)



由此可见，volatile关键字可以解决可见性 和 重排序问题。但是不能解决竞争问题，无法保证操作的原子性，解决竞争问题需要加锁，或者使用cas等无锁技术。



